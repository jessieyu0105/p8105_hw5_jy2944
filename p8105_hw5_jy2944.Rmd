---
title: "p8105_hw5_jy2944"
author: "Jie Yu"
date: "11/6/2018"
output: 
  github_document:
    toc: TRUE
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE)

library(tidyverse)
library(httr)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```


# Problem 1

### Import and tidy data

```{r p1_import_tidy}
# Start with a dataframe containing all file names: `list.files()`
study_df = tibble(file_names = list.files(path = "./data/problem1_data")) %>% 
  # Use `map()` to iterate over file names and read in data for each subject, and save the results in a new variable `data`
  mutate(data = map(.x = str_c("./data/problem1_data/", file_names), 
                    ~ read.csv(.x))) %>% 
  unnest() %>%
  # Begin Tidy
  janitor::clean_names() %>% 
  # remove str ".csv" in variable `file_names`
  mutate(file_names = str_replace(file_names, ".csv", "")) %>% 
  # manipulate file names to include study arm and subject ID
  separate(file_names, into = c("group", "subject_id"), sep = "_") %>% 
  # gather weekly observations
  gather(key = "week", value = "subject_data", week_1:week_8) %>% 
  mutate(
    # remove str "week_" in variable `week`
    week = str_replace(week, "week_", ""),
    subject_id = factor(subject_id),
    week = as.integer(week),
    group = factor(group)
  )
```

### Spaghetti plot

```{r p1_spaghetti_plot}
study_df %>% 
  mutate(group = recode(group, "con" = "control", "exp" = "experimental")) %>%
  ggplot(aes(x = week, y = subject_data, color = subject_id, group = subject_id)) +
  geom_point(alpha = 0.5) +
  geom_line() +
  facet_grid(. ~group) +
  labs(
    title = "Observations on each subject over time by control and experimental group",
    x = "Week",
    y = "Observation value",
    color = "Subject ID"
  ) 
```

Comments:

# Problem 2

```{r message = FALSE}
# Download the dataset from a Github repo: the file is too big to show on Github
homicide_data = GET("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv") %>% 
  content("raw") %>%
  read_csv()

str(homicide_data)
```

This raw data is gathered by the _Washington Post_, which records homicide cases in large U.S cities. The dataset is consisted of `r nrow(homicide_data)` observations and `r ncol(homicide_data)` variables. The variables contain information related to the reported date of each case, personal information of each victim (name, race, age, sex), information of the incident site (city, state, latitude, longitude), and the status of each case (`disposition`).


